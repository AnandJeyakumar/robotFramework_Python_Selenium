image: ubuntu:latest

pipelines:
  default:
    - step:
        name: Run Robot Framework Tests
        caches:
          - pip
        script:
          # Update and install required dependencies
          - apt-get update && apt-get install -y wget unzip python3-venv python3-pip curl gnupg

          # Add the Google Chrome repository (without sudo)
          - wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add -
          - sh -c 'echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google.list'
          - apt-get update

          # Install Google Chrome Stable
          - apt-get install -y google-chrome-stable

          # Install Chrome Dependencies
          - apt-get install -y libxss1 libnss3 fonts-liberation libgdk-pixbuf2.0-0 libnspr4 libcurl4


          # Install ChromeDriver (with chromedriver-autoinstaller)
          - pip install chromedriver-autoinstaller

          # Create virtual environment
          - python3 -m venv venv

          # Activate virtual environment
          - source venv/bin/activate

          # Install dependencies
          - pip install --upgrade pip
          - pip install -r tests/requirements.txt  # Ensure chromedriver-autoinstaller is in requirements.txt

          # Create results directory
          - mkdir -p results

          # Run Robot Framework tests
          - robot --outputdir results/ tests/

        artifacts:
          - results/**
